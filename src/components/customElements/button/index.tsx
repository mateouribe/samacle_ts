import React, { useLayoutEffect, useRef } from "react";
import { colors } from "../../../utils/constants";
import { gsap } from "gsap";
import { useNavigate } from "react-router";
import { navigateToPage } from "../../../utils/navigateToPage";

type Props = {
  children: React.ReactNode;
  className?: string;
  onClick?: () => void;
  navigateTo?: string;
  type?: "button" | "submit" | "reset";
  blackColor?: boolean;
  widthFull?: boolean;
  icon?: "plane" | "eye" | "bumb";
  loading?: boolean;
};

const Button = ({
  children,
  className,
  onClick,
  navigateTo,
  type = "button",
  blackColor,
  widthFull = false,
  icon = "bumb",
  loading = false,
}: Props) => {
  const navigate = useNavigate();
  const container = useRef(null);
  const tl = useRef(null || gsap.timeline());
  const exitTime = useRef<number>(0);
  const color = blackColor ? colors.black : colors.main;

  useLayoutEffect(() => {
    const scaleFrom = 0.9;
    const ctx = gsap.context(() => {
      if (!loading) {
        gsap.set(".btn_icon", {
          scale: scaleFrom,
          opacity: 0,
        });
        tl.current = gsap.timeline({ paused: true });

        //Mouse enter
        tl.current.fromTo(
          container.current,
          { paddingRight: "28px" },
          {
            paddingRight: "50px",
            duration: 0.2,
          }
        );
        tl.current.fromTo(
          ".btn_icon",
          {
            scale: scaleFrom,
          },
          { scale: 1, duration: 0.3, ease: "bounce.out" },
          "-=0.1"
        );
        tl.current.fromTo(
          ".btn_icon",
          {
            opacity: 0,
          },
          {
            opacity: 1,
          },
          "-=0.5"
        );
        tl.current.addPause();
        exitTime.current = tl.current.duration();

        //Mouse leave
        tl.current.to(".btn_icon", {
          scale: scaleFrom,
          opacity: 0,
          duration: 0.1,
        });
        tl.current.to(container.current, {
          paddingRight: "28px",
          duration: 0.1,
        });
      }
    }, container);

    return () => ctx.revert();
  }, [loading]);

  return (
    <button
      className={`text-center px-[28px] py-[16px] rounded-button text-[17px] leading-[20px] font-medium border-[1px] border-transparent relative ${className} ${
        widthFull ? "w-full" : "max-w-fit"
      } ${
        loading
          ? blackColor
            ? "bg-black/30 border-[1px] border-black"
            : "bg-main/30 border-[1px] border-main"
          : blackColor
          ? "bg-black"
          : "bg-main"
      }`}
      style={{
        color: blackColor ? colors.white : colors.black,
      }}
      onClick={() => {
        onClick && onClick();
        navigateTo && navigateToPage(navigate, navigateTo);
      }}
      ref={container}
      onMouseEnter={() => {
        if (tl.current !== null && tl.current !== undefined && !loading) {
          if (tl.current.time() < exitTime.current) {
            tl.current.play();
          } else {
            tl.current.restart();
          }
        }
      }}
      onMouseLeave={() => {
        if (tl.current !== null && tl.current !== undefined && !loading) {
          if (tl.current.time() < exitTime.current) {
            tl.current.reverse();
          } else {
            tl.current.play();
          }
        }
      }}
      type={type}
    >
      {loading ? (
        <div className="w-full h-full">
          {/* <Lottie animationData={Plane} height={400} width={400} /> */}
        </div>
      ) : (
        <>
          {children}
          <div
            className={`absolute transform -translate-y-1/2 btn_icon -right-[15px] top-[10px] `}
          >
            {icon === "plane" ? (
              <svg
                width="33"
                height="42"
                viewBox="0 0 33 42"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M28.6072 0.789689L1.48772 16.4418L1.66639 19.8604C1.66648 19.8604 1.66657 19.8605 1.66665 19.8605L7.88819 22.474L8.17717 22.5954L8.41236 22.3882L23.8396 8.79652L10.9678 24.5417L10.8549 24.6798V24.8582V29.5749C10.852 29.9668 10.9696 30.35 11.1919 30.6728C11.4146 30.9962 11.7314 31.2431 12.0994 31.38C12.4674 31.517 12.8686 31.5372 13.2485 31.438C13.6284 31.3389 13.9686 31.1251 14.2227 30.8258L14.2227 30.8258L14.2279 30.8195L17.7154 26.5739L24.6581 29.4942L24.6609 29.4954C24.927 29.6054 25.2145 29.6539 25.5019 29.6372C25.7893 29.6205 26.0692 29.539 26.3207 29.3989C26.5723 29.2589 26.7889 29.0638 26.9545 28.8282C27.1198 28.593 27.2299 28.3234 27.2766 28.0397C27.2767 28.0393 27.2767 28.039 27.2768 28.0387L31.4971 2.76298C31.5653 2.39895 31.5263 2.0229 31.3847 1.68058C31.2423 1.33635 31.0024 1.04124 30.6946 0.831539C30.3867 0.621843 30.0242 0.506704 29.6517 0.500284C29.2829 0.493926 28.9201 0.59448 28.6072 0.789689Z"
                  fill="black"
                />
                <path
                  d="M8.88695 40.7695L8.89817 40.7824L8.91025 40.7945C8.91148 40.7957 8.91283 40.7971 8.91429 40.7986C8.93581 40.8202 8.98192 40.8666 9.03798 40.9087C9.39915 41.1801 9.91505 41.1739 10.2748 40.8552L10.2749 40.8551C10.6736 40.5016 10.7205 39.8917 10.3705 39.4826L10.3705 39.4826L10.3677 39.4794L8.83971 37.7235L8.83927 37.723C8.23434 37.0297 7.94557 36.1401 8.0261 35.2249L8.02619 35.2239C8.03164 35.1605 8.03869 35.0978 8.04733 35.0358C8.66569 35.4741 9.48442 35.5892 10.2181 35.2934L10.3102 35.2568L10.3102 35.2568L10.3147 35.255C10.9522 34.9949 11.4353 34.4644 11.6339 33.805C11.8364 33.1385 11.7222 32.4318 11.3283 31.8617L11.3283 31.8617L11.3265 31.8592C10.9677 31.3465 10.4095 30.9941 9.77974 30.904C9.15216 30.8143 8.51512 30.9917 8.02593 31.3884C7.97461 31.43 7.92406 31.4726 7.87435 31.5159L7.82939 31.4474L7.82925 31.4471C7.53236 30.995 7.4767 30.4559 7.67372 29.9561C7.87517 29.4574 8.28773 29.1022 8.80968 28.9786L8.80969 28.9786L8.81487 28.9773C9.33373 28.8486 9.65845 28.3265 9.53505 27.8033L9.53508 27.8033L9.53369 27.7977C9.40498 27.2788 8.88286 26.9541 8.35963 27.0775C7.22265 27.3456 6.29008 28.1542 5.85856 29.235L5.85856 29.235L5.85772 29.2371C5.4306 30.3213 5.55757 31.5514 6.19782 32.5243L6.19809 32.5247L6.61076 33.1505C6.31738 33.7407 6.1333 34.3869 6.07376 35.0619L6.07365 35.0632C5.94946 36.5127 6.40383 37.9147 7.35876 39.0134L7.35896 39.0136L8.88695 40.7695ZM9.4859 33.4906L9.48589 33.4906L9.48213 33.4921C9.34731 33.5469 9.18507 33.4997 9.0977 33.3704L8.96813 33.1727C9.05727 33.0815 9.15227 32.9954 9.25198 32.9159L9.25318 32.915C9.32728 32.8555 9.41436 32.8328 9.50038 32.8452C9.58449 32.8574 9.66223 32.9036 9.71826 32.9835L9.71985 32.9858C9.77367 33.0617 9.78969 33.1577 9.76167 33.2508C9.73367 33.3438 9.66734 33.4173 9.57695 33.4545L9.4859 33.4906Z"
                  fill="black"
                />
              </svg>
            ) : icon === "bumb" ? (
              <svg
                width="46"
                height="46"
                viewBox="0 0 46 46"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M29.8324 32.1388L29.8324 32.1389L29.8386 32.1334C31.5756 30.6145 32.8192 28.6315 33.3717 26.4045C34.8547 20.4264 31.116 14.3211 25.0466 12.7482L25.0389 12.7462L25.0311 12.7445C22.0733 12.0778 19.0326 12.5326 16.4737 14.0544C13.9148 15.5761 12.0799 18.0215 11.3552 20.9426C10.8027 23.1697 10.9752 25.504 11.8009 27.6586L11.8055 27.6708L11.8108 27.6827C11.9074 27.9 12 28.1116 12.0899 28.3172C12.3802 28.9808 12.6429 29.5812 12.9218 30.106C13.3798 31.0278 13.7076 31.7091 13.8872 32.4644C14.0642 33.2091 14.1022 34.0532 13.923 35.2819L13.9148 35.3383L13.9195 35.395C13.9352 35.5862 14.0066 35.7748 14.1119 35.9287C14.2147 36.0787 14.3872 36.248 14.6366 36.3099L23.2882 38.4561C23.7378 38.5677 24.2679 38.3446 24.4058 37.863C24.8178 36.7096 25.2531 36.0056 25.7579 35.4492C26.2208 34.9391 26.7501 34.5407 27.4378 34.0233C27.524 33.9584 27.6127 33.8917 27.704 33.8226L27.7041 33.8226L27.7095 33.8184C27.8389 33.7178 27.9781 33.6111 28.126 33.4976C28.6119 33.1251 29.1925 32.6799 29.8324 32.1388ZM24.0062 39.2138L24.1266 38.7285L23.6413 38.6081L14.3148 36.2944L13.8295 36.174L13.7091 36.6593L13.1372 38.9644C12.5374 41.3824 14.484 43.8062 17.171 44.4728L17.2937 44.5032C20.0466 45.1861 22.8354 43.9332 23.4343 41.5189L24.0062 39.2138ZM35.0901 15.0691L35.0971 15.0821L35.1047 15.0946C35.3692 15.5281 35.8282 15.8093 36.2412 15.9117C36.7277 16.0324 37.201 15.9744 37.6278 15.7205L42.5943 12.767C43.0401 12.5018 43.3184 12.0402 43.433 11.5784C43.5535 11.0926 43.491 10.6206 43.2321 10.1963C42.9675 9.76281 42.5086 9.48162 42.0956 9.37915C41.6091 9.25847 41.1358 9.31649 40.7089 9.57033L35.7425 12.5239C34.8789 13.0375 34.6222 14.19 35.0901 15.0691ZM9.68418 4.58071L9.69109 4.59369L9.69875 4.60624L12.7089 9.53864C12.9734 9.9721 13.4323 10.2533 13.8454 10.3558C14.3318 10.4764 14.8052 10.4184 15.232 10.1646C15.6778 9.89944 15.9561 9.43784 16.0707 8.97597C16.1912 8.49022 16.1287 8.01819 15.8697 7.59386L12.8596 2.66147C12.5951 2.22801 12.1362 1.94682 11.7231 1.84435C11.2367 1.72367 10.7633 1.78169 10.3365 2.03553C9.47289 2.54912 9.21625 3.70162 9.68418 4.58071ZM25.7951 9.97175C26.7942 10.2196 27.8334 9.60835 28.0818 8.60718L29.4512 3.08701C29.6996 2.08584 29.0666 1.05975 28.0675 0.811904C27.0684 0.564053 26.0293 1.1753 25.7809 2.17647L24.4114 7.69664C24.1631 8.69781 24.7961 9.72389 25.7951 9.97175ZM43.3902 24.6399L37.8066 23.2547C36.8075 23.0068 35.7683 23.6181 35.5199 24.6192C35.2716 25.6204 35.9046 26.6465 36.9036 26.8943L42.4873 28.2795C43.4863 28.5274 44.5255 27.9161 44.7739 26.915C45.0223 25.9138 44.3893 24.8877 43.3902 24.6399ZM8.9681 16.1004L3.38448 14.7152C2.3854 14.4674 1.3462 15.0786 1.09783 16.0798C0.849465 17.081 1.48247 18.107 2.48155 18.3549L8.06517 19.7401C9.06424 19.9879 10.1034 19.3767 10.3518 18.3755C10.6002 17.3744 9.96717 16.3483 8.9681 16.1004Z"
                  fill="white"
                  stroke={color}
                />
              </svg>
            ) : (
              <svg
                width="47"
                height="48"
                viewBox="0 0 47 48"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M2.11433 25.9569L2.03896 26.0919L2.05302 26.246C2.81161 34.554 9.90801 42.0508 19.5573 43.879C29.2225 45.7102 38.1847 41.2441 42.2884 33.8903L42.3638 33.7552L42.3497 33.6011C41.5911 25.2931 34.4947 17.7963 24.8454 15.9681C15.1802 14.1369 6.21805 18.6031 2.11433 25.9569ZM24.3835 18.4062C30.6623 19.5958 34.9083 25.8269 33.7187 32.1057C32.5291 38.3845 26.2981 42.6305 20.0192 41.4409C13.7404 40.2513 9.49443 34.0203 10.684 27.7414C11.8737 21.4626 18.1047 17.2166 24.3835 18.4062Z"
                  fill="white"
                  stroke={color}
                />
                <path
                  d="M27.7182 31.3458C28.3211 28.1633 26.3732 25.3046 23.1907 24.7016C20.0082 24.0987 17.1495 26.0466 16.5466 29.2291C15.9436 32.4116 17.8916 35.2703 21.0741 35.8733C24.2565 36.4762 27.1152 34.5282 27.7182 31.3458Z"
                  fill="white"
                  stroke={color}
                />
                <path
                  d="M27.3886 13.1893L28.9054 5.18362C29.0051 4.65768 28.8456 4.19846 28.543 3.86201C28.2521 3.53855 27.845 3.34293 27.4404 3.26628C27.0359 3.18964 26.5854 3.22277 26.1963 3.41739C25.7916 3.61984 25.4753 3.98891 25.3756 4.51485L23.8588 12.5206C23.7592 13.0465 23.9186 13.5057 24.2212 13.8422C24.5121 14.1656 24.9193 14.3613 25.3238 14.4379C25.7284 14.5146 26.1789 14.4814 26.5679 14.2868C26.9726 14.0844 27.289 13.7153 27.3886 13.1893Z"
                  fill="white"
                  stroke={color}
                />
                <path
                  d="M35.5461 17.6012L35.5523 17.593L35.5581 17.5847L40.2066 10.9351C40.5345 10.5 40.6367 10.0182 40.5487 9.56834C40.4624 9.12757 40.2015 8.75478 39.8696 8.50206C39.5378 8.24934 39.1091 8.09688 38.6612 8.13087C38.2011 8.16579 37.7611 8.39512 37.428 8.83248L37.4218 8.84059L37.4159 8.84895L32.7674 15.4986C32.4395 15.9337 32.3374 16.4154 32.4254 16.8653C32.5117 17.3061 32.7726 17.6789 33.1044 17.9316C33.4362 18.1843 33.865 18.3368 34.3128 18.3028C34.7729 18.2678 35.213 18.0385 35.5461 17.6012Z"
                  fill="white"
                  stroke={color}
                />
                <path
                  d="M16.1142 4.81297L16.1118 4.80305L16.109 4.79324C15.959 4.26434 15.6333 3.88994 15.2178 3.68913C14.8135 3.49367 14.3587 3.47874 13.9574 3.59257C13.5561 3.70639 13.1769 3.95789 12.9354 4.33657C12.6889 4.72305 12.6078 5.2088 12.7538 5.73368L14.6477 13.6229L14.6501 13.6328L14.6529 13.6426C14.8029 14.1715 15.1286 14.5459 15.5441 14.7467C15.9484 14.9422 16.4032 14.9571 16.8045 14.8433C17.2058 14.7294 17.585 14.4779 17.8265 14.0993C18.073 13.7128 18.1541 13.227 18.0081 12.7022L16.1142 4.81297Z"
                  fill="white"
                  stroke={color}
                />
              </svg>
            )}
          </div>
        </>
      )}
    </button>
  );
};

export default Button;
